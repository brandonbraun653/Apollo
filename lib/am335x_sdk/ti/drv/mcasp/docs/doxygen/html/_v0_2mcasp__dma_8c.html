<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>mcasp_dma.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="../../tilogo.gif"></a></td>
  <td bgcolor="red"><img src="../../titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_a2868d71d9e966ef94c514064b2b1009.html">dma</a></li><li class="navelem"><a class="el" href="dir_b1f45321ca6d50b8222eb4e1263a96aa.html">V0</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">V0/mcasp_dma.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This files contains the edma functions required for the Mcasp driver to function in the EDMA mode.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;ti/csl/cslr_device.h&gt;</code><br />
<code>#include &lt;ti/sdo/edma3/drv/src/edma3.h&gt;</code><br />
<code>#include &lt;<a class="el" href="mcasp__drv_8h.html">ti/drv/mcasp/mcasp_drv.h</a>&gt;</code><br />
<code>#include &lt;ti/drv/mcasp/mcasp_osal.h&gt;</code><br />
<code>#include &lt;<a class="el" href="mcasp__soc_8h.html">ti/drv/mcasp/soc/mcasp_soc.h</a>&gt;</code><br />
<code>#include &lt;include/McaspLocal.h&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:acbad69e41c5d3be5b164733df2a8abc4"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#acbad69e41c5d3be5b164733df2a8abc4">Mcasp_setupDmaDuringOpen</a> (<a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a> chanHandle, <a class="el" href="struct_mcasp___hw_obj__s.html">Mcasp_HwObj</a> *hwInfo)</td></tr>
<tr class="memdesc:acbad69e41c5d3be5b164733df2a8abc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is called during channel creation (during open) This function does the following 1) Request the Xfer (in/out depends on mode) channel to EDMA driver for this peripheral; 2) Requests the link channels for linking (exclusive for each direction (tx/rx)  <a href="#acbad69e41c5d3be5b164733df2a8abc4">More...</a><br /></td></tr>
<tr class="separator:acbad69e41c5d3be5b164733df2a8abc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7936809965e73a06d024a60b1fa0a6b6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#a7936809965e73a06d024a60b1fa0a6b6">Mcasp_localEdmaCallback</a> (uint32_t tcc, EDMA3_RM_TccStatus status, void *data)</td></tr>
<tr class="memdesc:a7936809965e73a06d024a60b1fa0a6b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">This calls the registered application callback for the current receive request and triggers the common DMA callback routine.  <a href="#a7936809965e73a06d024a60b1fa0a6b6">More...</a><br /></td></tr>
<tr class="separator:a7936809965e73a06d024a60b1fa0a6b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaad7eb1bde5519d0f006f3d2a69969d"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#adaad7eb1bde5519d0f006f3d2a69969d">Mcasp_setupDmaChan</a> (<a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a> chanHandle)</td></tr>
<tr class="memdesc:adaad7eb1bde5519d0f006f3d2a69969d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function does the following 1) set up the param set of main xfer channel (for loopjob transfers) 2) set up the param sets of all link channel (for loopjob transfers) 3) link the last link channel to itself (this channel will be linked to main xfer channel later and to supply the loopjob xfer information infinely this is done so; other link channels are setup here just for completion sake.  <a href="#adaad7eb1bde5519d0f006f3d2a69969d">More...</a><br /></td></tr>
<tr class="separator:adaad7eb1bde5519d0f006f3d2a69969d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a847f84392a1586760f81d849e6178f76"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#a847f84392a1586760f81d849e6178f76">Mcasp_submitPktToDma</a> (<a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a> chanHandle, <a class="el" href="group___d_r_v___m_c_a_s_p___a_p_i___m_o_d_u_l_e.html#ga953a2d16a46a5ae307a4b1a888198926">MCASP_Packet</a> *const ioPacket)</td></tr>
<tr class="memdesc:a847f84392a1586760f81d849e6178f76"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function updates the link param set accordingly with data or loopjobbuffer. This uses properly maintained index to idendtify to what param set the info has to be updated.  <a href="#a847f84392a1586760f81d849e6178f76">More...</a><br /></td></tr>
<tr class="separator:a847f84392a1586760f81d849e6178f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7919ae2d63d5df42486e01fa5288d2a9"><td class="memItemLeft" align="right" valign="top">int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#a7919ae2d63d5df42486e01fa5288d2a9">Mcasp_localGetIndicesSyncType</a> (<a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a> chanHandle, volatile int16_t *bIndex, volatile int16_t *cIndex, volatile uint16_t *aCnt, volatile uint16_t *bCnt, volatile uint16_t *cCnt, EDMA3_DRV_SyncType *syncType, Bool forLoopJobBuf)</td></tr>
<tr class="memdesc:a7919ae2d63d5df42486e01fa5288d2a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mcasp_localGetIndicesSyncType.  <a href="#a7919ae2d63d5df42486e01fa5288d2a9">More...</a><br /></td></tr>
<tr class="separator:a7919ae2d63d5df42486e01fa5288d2a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a00b9f5e16c8e48bff3a3135b53a8693d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00b9f5e16c8e48bff3a3135b53a8693d"></a>
<a class="el" href="struct_mcasp___temp_buffer__s.html">Mcasp_TempBuffer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_v0_2mcasp__dma_8c.html#a00b9f5e16c8e48bff3a3135b53a8693d">Mcasp_muteBuf</a> [MCASP_CNT]</td></tr>
<tr class="memdesc:a00b9f5e16c8e48bff3a3135b53a8693d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Mute buffer per instance. <br /></td></tr>
<tr class="separator:a00b9f5e16c8e48bff3a3135b53a8693d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This files contains the edma functions required for the Mcasp driver to function in the EDMA mode. </p>
<p>(C) Copyright 2019, Texas Instruments, Inc</p>
<dl class="section version"><dt>Version</dt><dd>0.2 Added the support for the Non loop job mode 0.1 Newly created. </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a7936809965e73a06d024a60b1fa0a6b6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Mcasp_localEdmaCallback </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>tcc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EDMA3_RM_TccStatus&#160;</td>
          <td class="paramname"><em>status</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This calls the registered application callback for the current receive request and triggers the common DMA callback routine. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tcc</td><td>[IN] tcc number of EDMA </td></tr>
    <tr><td class="paramname">status</td><td>[IN] status of EDMA transaction </td></tr>
    <tr><td class="paramname">data</td><td>[IN] paramaters sent to EDMA ISR (chan handler)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Nothing </dd></dl>

</div>
</div>
<a class="anchor" id="a7919ae2d63d5df42486e01fa5288d2a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t Mcasp_localGetIndicesSyncType </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a>&#160;</td>
          <td class="paramname"><em>chanHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile int16_t *&#160;</td>
          <td class="paramname"><em>bIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile int16_t *&#160;</td>
          <td class="paramname"><em>cIndex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile uint16_t *&#160;</td>
          <td class="paramname"><em>aCnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile uint16_t *&#160;</td>
          <td class="paramname"><em>bCnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">volatile uint16_t *&#160;</td>
          <td class="paramname"><em>cCnt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EDMA3_DRV_SyncType *&#160;</td>
          <td class="paramname"><em>syncType</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bool&#160;</td>
          <td class="paramname"><em>forLoopJobBuf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Mcasp_localGetIndicesSyncType. </p>
<p>This function computes the parameters requied to configure EDMA 3 based on the buffer format seleted while creating the driver.</p>
<p>Entry Criteria : This function expects channel variables such as no of slots serializers, length of buffers is updated.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chanHandle</td><td>[IN] Pointer to channel handle </td></tr>
    <tr><td class="paramname">bIndex</td><td>[IN] Pointer to stores computed bIndex </td></tr>
    <tr><td class="paramname">cIndex</td><td>[IN] Pointer to stores computed cIndex </td></tr>
    <tr><td class="paramname">aCnt</td><td>[IN] Pointer to stores computed aCnt </td></tr>
    <tr><td class="paramname">bCnt</td><td>[IN] Pointer to stores computed bCnt </td></tr>
    <tr><td class="paramname">cCnt</td><td>[IN] Pointer to stores computed cCnt </td></tr>
    <tr><td class="paramname">syncType</td><td>[IN] Pointer to stores computed mode of EDMA </td></tr>
    <tr><td class="paramname">forLoopJobBuf</td><td>[IN] To calucalate above for loopJob or data</td></tr>
  </table>
  </dd>
</dl>
<p>CAUTION : This function could be called with pointer pointing to EDMA 3 paramset pointer (avoiding couple of variables). Care should be take to ensure that data types used in EDMA 3 paramset is consistent with EDMA 3 defined data types.</p>
<dl class="section return"><dt>Returns</dt><dd>MCASP_EBADARGS on invalid buffer format, else MCASP_COMPLETED </dd></dl>

</div>
</div>
<a class="anchor" id="adaad7eb1bde5519d0f006f3d2a69969d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t Mcasp_setupDmaChan </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a>&#160;</td>
          <td class="paramname"><em>chanHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function does the following 1) set up the param set of main xfer channel (for loopjob transfers) 2) set up the param sets of all link channel (for loopjob transfers) 3) link the last link channel to itself (this channel will be linked to main xfer channel later and to supply the loopjob xfer information infinely this is done so; other link channels are setup here just for completion sake. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chanHandle</td><td>[IN] Handle to the mcasp channel</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MCASP_COMPLETED if is success Error id if failed </dd></dl>

</div>
</div>
<a class="anchor" id="acbad69e41c5d3be5b164733df2a8abc4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t Mcasp_setupDmaDuringOpen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a>&#160;</td>
          <td class="paramname"><em>chanHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct_mcasp___hw_obj__s.html">Mcasp_HwObj</a> *&#160;</td>
          <td class="paramname"><em>hwInfo</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is called during channel creation (during open) This function does the following 1) Request the Xfer (in/out depends on mode) channel to EDMA driver for this peripheral; 2) Requests the link channels for linking (exclusive for each direction (tx/rx) </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chanHandle</td><td>[IN] pointer to the channel object </td></tr>
    <tr><td class="paramname">hwInfo</td><td>[IN] pointer to the Mcasp_HwObj object</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>status MCASP_COMPLETED if is sucess error id in case of failure </dd></dl>

</div>
</div>
<a class="anchor" id="a847f84392a1586760f81d849e6178f76"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t Mcasp_submitPktToDma </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_mcasp___channel_obj__s.html">Mcasp_ChannelHandle</a>&#160;</td>
          <td class="paramname"><em>chanHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group___d_r_v___m_c_a_s_p___a_p_i___m_o_d_u_l_e.html#ga953a2d16a46a5ae307a4b1a888198926">MCASP_Packet</a> *const&#160;</td>
          <td class="paramname"><em>ioPacket</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function updates the link param set accordingly with data or loopjobbuffer. This uses properly maintained index to idendtify to what param set the info has to be updated. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">chanHandle</td><td>[IN] Handle to the mcasp channel </td></tr>
    <tr><td class="paramname">ioPacket</td><td>[IN] Pointer to I/O packet</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>MCASP_COMPLETED in case of sucess else Error code in case of failure </dd></dl>

</div>
</div>
</div><!-- contents -->
<hr size="1"><small>
Copyright  2020, Texas Instruments Incorporated</small>
</body>
</html>
