<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>icss_timeSync.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="../../tilogo.gif"></a></td>
  <td bgcolor="red"><img src="../../titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.8.9.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">icss_timeSync.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Contains the main PTP-1588 driver implementation functions like ISR's, timers, synchronization, RCF calculation, line and peer delay calculation.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;xdc/std.h&gt;</code><br />
<code>#include &lt;math.h&gt;</code><br />
<code>#include &lt;ti/transport/timeSync/include/icss_timeSync.h&gt;</code><br />
<code>#include &lt;ti/drv/icss_emac/firmware/icss_dualemac/src/icss_timeSync_memory_map.h&gt;</code><br />
<code>#include &lt;ti/transport/timeSync/include/icss_timeSyncApi.h&gt;</code><br />
<code>#include &lt;ti/transport/timeSync/include/icss_timeSync_ecap_edma.h&gt;</code><br />
<code>#include &lt;<a class="el" href="icss__time_sync__init_8h.html">ti/transport/timeSync/include/icss_timeSync_init.h</a>&gt;</code><br />
<code>#include &lt;ti/drv/icss_emac/icss_emac_ver.h&gt;</code><br />
<code>#include &lt;ti/transport/timeSync/include/icss_timeSync_tools.h&gt;</code><br />
<code>#include &lt;<a class="el" href="soc__icss__header_8h.html">ti/transport/timeSync/include/soc_icss_header.h</a>&gt;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ade3b4bd7a3621759478b6043c83fa4e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#ade3b4bd7a3621759478b6043c83fa4e2">TimeSync_resetIEP</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle)</td></tr>
<tr class="memdesc:ade3b4bd7a3621759478b6043c83fa4e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets CMP1 once first adjustment is done, else 1PPS signal doesn't trigger.  <a href="#ade3b4bd7a3621759478b6043c83fa4e2">More...</a><br /></td></tr>
<tr class="separator:ade3b4bd7a3621759478b6043c83fa4e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aad49829084a2b2aa0e68a019fa268de0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#aad49829084a2b2aa0e68a019fa268de0">TimeSync_doFirstAdjustment</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint8_t portNum)</td></tr>
<tr class="memdesc:aad49829084a2b2aa0e68a019fa268de0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Do initial adjustment for the IEP based on sync timestamp.  <a href="#aad49829084a2b2aa0e68a019fa268de0">More...</a><br /></td></tr>
<tr class="separator:aad49829084a2b2aa0e68a019fa268de0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73b1374d01c2e31d6a5eb24c7824bc47"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a73b1374d01c2e31d6a5eb24c7824bc47">TimeSync_processTimeOfDay</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint32_t nanoseconds, uint64_t seconds)</td></tr>
<tr class="memdesc:a73b1374d01c2e31d6a5eb24c7824bc47"><td class="mdescLeft">&#160;</td><td class="mdescRight">When application receives the Time of Day information, it calls this API with the seconds and nanoseconds fields. This starts the time of day synchronization mechanism. Assumption : Latch0 input is also enabled and is being fed by 1PPS output.  <a href="#a73b1374d01c2e31d6a5eb24c7824bc47">More...</a><br /></td></tr>
<tr class="separator:a73b1374d01c2e31d6a5eb24c7824bc47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d9348a67c56e2431736a2824cdfcf55"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a0d9348a67c56e2431736a2824cdfcf55">TimeSync_processPTPFrame</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint8_t *pktBuffer, uint8_t portNum, uint16_t size, uint8_t isLinkLocal)</td></tr>
<tr class="memdesc:a0d9348a67c56e2431736a2824cdfcf55"><td class="mdescLeft">&#160;</td><td class="mdescRight">Processes a PTP Announce message and extract fields.  <a href="#a0d9348a67c56e2431736a2824cdfcf55">More...</a><br /></td></tr>
<tr class="separator:a0d9348a67c56e2431736a2824cdfcf55"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6b9a5db767679094b8a9751df153657b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a6b9a5db767679094b8a9751df153657b">TimeSync_processPdelayReqFrame</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint8_t *buff, uint8_t portNum)</td></tr>
<tr class="separator:a6b9a5db767679094b8a9751df153657b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82f21f97872e71a9256e68313df6d2a7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a82f21f97872e71a9256e68313df6d2a7">TimeSync_getGeneralMessage</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, int8_t *buff)</td></tr>
<tr class="memdesc:a82f21f97872e71a9256e68313df6d2a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Copies the PTP announce message data to PTP stack buffer.  <a href="#a82f21f97872e71a9256e68313df6d2a7">More...</a><br /></td></tr>
<tr class="separator:a82f21f97872e71a9256e68313df6d2a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84186cafae1f72ee308b2bb3c98f8a15"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a84186cafae1f72ee308b2bb3c98f8a15">TimeSync_isEnabled</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle)</td></tr>
<tr class="memdesc:a84186cafae1f72ee308b2bb3c98f8a15"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return True/False 1/0 if timeSync module is enabled.  <a href="#a84186cafae1f72ee308b2bb3c98f8a15">More...</a><br /></td></tr>
<tr class="separator:a84186cafae1f72ee308b2bb3c98f8a15"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc6d5a7aed0c6574d98c34e859817463"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#acc6d5a7aed0c6574d98c34e859817463">TimeSync_updateParentAddress</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint8_t *parentMac)</td></tr>
<tr class="memdesc:acc6d5a7aed0c6574d98c34e859817463"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write the MAC ID of PTP master to Firmware. BMC Algorithm calls this API.  <a href="#acc6d5a7aed0c6574d98c34e859817463">More...</a><br /></td></tr>
<tr class="separator:acc6d5a7aed0c6574d98c34e859817463"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5664bb938a6623cb3055eeead89e0b1f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a5664bb938a6623cb3055eeead89e0b1f">TimeSync_getPrevAddress</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle, uint8_t *prevMac)</td></tr>
<tr class="memdesc:a5664bb938a6623cb3055eeead89e0b1f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retuns the previous master's MAC ID. BMC Algorithm calls this.  <a href="#a5664bb938a6623cb3055eeead89e0b1f">More...</a><br /></td></tr>
<tr class="separator:a5664bb938a6623cb3055eeead89e0b1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3e0a32556f548a0814024c07c32fb3f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#ae3e0a32556f548a0814024c07c32fb3f">TimeSync_Port1linkResetCallBack</a> (uint8_t linkStatus, void *arg2)</td></tr>
<tr class="memdesc:ae3e0a32556f548a0814024c07c32fb3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for link status change on Port 1.  <a href="#ae3e0a32556f548a0814024c07c32fb3f">More...</a><br /></td></tr>
<tr class="separator:ae3e0a32556f548a0814024c07c32fb3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a807b9b6e2780ebf878bd9201a28675d7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a807b9b6e2780ebf878bd9201a28675d7">TimeSync_Port2linkResetCallBack</a> (uint8_t linkStatus, void *arg2)</td></tr>
<tr class="memdesc:a807b9b6e2780ebf878bd9201a28675d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Callback for link status change on Port 2.  <a href="#a807b9b6e2780ebf878bd9201a28675d7">More...</a><br /></td></tr>
<tr class="separator:a807b9b6e2780ebf878bd9201a28675d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0ecd71c8cf84fc9ee69373dba314d9c2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#a0ecd71c8cf84fc9ee69373dba314d9c2">TimeSync_reset</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle)</td></tr>
<tr class="memdesc:a0ecd71c8cf84fc9ee69373dba314d9c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset the state machine in firmware to restart synchronization (First adjustment happens again)  <a href="#a0ecd71c8cf84fc9ee69373dba314d9c2">More...</a><br /></td></tr>
<tr class="separator:a0ecd71c8cf84fc9ee69373dba314d9c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab54c2639b47e079c1eb32fcf933e3bca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="icss__time_sync_8c.html#ab54c2639b47e079c1eb32fcf933e3bca">TimeSync_rxPhyDelayCorrection</a> (<a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a> timeSyncHandle)</td></tr>
<tr class="memdesc:ab54c2639b47e079c1eb32fcf933e3bca"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs PHY delay correction on Rx timestamp Assumption : The function expects the timestamp in rxTimestamp_gPTP field on which it does correction.  <a href="#ab54c2639b47e079c1eb32fcf933e3bca">More...</a><br /></td></tr>
<tr class="separator:ab54c2639b47e079c1eb32fcf933e3bca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Contains the main PTP-1588 driver implementation functions like ISR's, timers, synchronization, RCF calculation, line and peer delay calculation. </p>
<p>Copyright (c) 2018, Texas Instruments Incorporated All rights reserved.</p>
<p>Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:</p>
<ul>
<li>Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.</li>
<li>Neither the name of Texas Instruments Incorporated nor the names of its contributors may be used to endorse or promote products derived from this software without specific prior written permission.</li>
</ul>
<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aad49829084a2b2aa0e68a019fa268de0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_doFirstAdjustment </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>portNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Do initial adjustment for the IEP based on sync timestamp. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">portNum</td><td>ICSS_EMAC_PORT_1 or ICSS_EMAC_PORT_2 </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a class="anchor" id="a82f21f97872e71a9256e68313df6d2a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_getGeneralMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t *&#160;</td>
          <td class="paramname"><em>buff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Copies the PTP announce message data to PTP stack buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">buff</td><td>Pointer to buffer of PTP Stack. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a class="anchor" id="a5664bb938a6623cb3055eeead89e0b1f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_getPrevAddress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>prevMac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retuns the previous master's MAC ID. BMC Algorithm calls this. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">prevMac</td><td>Pointer to MAC ID of previous master. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a class="anchor" id="a84186cafae1f72ee308b2bb3c98f8a15"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t TimeSync_isEnabled </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return True/False 1/0 if timeSync module is enabled. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a class="anchor" id="ae3e0a32556f548a0814024c07c32fb3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_Port1linkResetCallBack </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>linkStatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for link status change on Port 1. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">linkStatus</td><td>1/0 whether up or down </td></tr>
    <tr><td class="paramname">arg2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>arg2 timeSyncHandle pointer to PTP Handle structure </dd></dl>

</div>
</div>
<a class="anchor" id="a807b9b6e2780ebf878bd9201a28675d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_Port2linkResetCallBack </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>linkStatus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>arg2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Callback for link status change on Port 2. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">linkStatus</td><td>1/0 whether up or down </td></tr>
    <tr><td class="paramname">arg2</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>arg2 timeSyncHandle pointer to PTP Handle structure </dd></dl>

</div>
</div>
<a class="anchor" id="a6b9a5db767679094b8a9751df153657b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_processPdelayReqFrame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>portNum</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add requested source port identity</p>
<p>Copy sequence ID from Delay Req packet </p>

</div>
</div>
<a class="anchor" id="a0d9348a67c56e2431736a2824cdfcf55"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_processPTPFrame </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>pktBuffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>portNum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>isLinkLocal</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Processes a PTP Announce message and extract fields. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">pktBuffer</td><td>pointer to packet data </td></tr>
    <tr><td class="paramname">portNum</td><td>port number on which the packet was received </td></tr>
    <tr><td class="paramname">size</td><td>size of the packet </td></tr>
    <tr><td class="paramname">isLinkLocal</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a class="anchor" id="a73b1374d01c2e31d6a5eb24c7824bc47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t TimeSync_processTimeOfDay </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>nanoseconds</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>seconds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>When application receives the Time of Day information, it calls this API with the seconds and nanoseconds fields. This starts the time of day synchronization mechanism. Assumption : Latch0 input is also enabled and is being fed by 1PPS output. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">nanoseconds</td><td>Nanoseconds component of time of day </td></tr>
    <tr><td class="paramname">seconds</td><td>Seconds component of time of day </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Error value </dd></dl>

</div>
</div>
<a class="anchor" id="a0ecd71c8cf84fc9ee69373dba314d9c2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reset the state machine in firmware to restart synchronization (First adjustment happens again) </p>
<p>If Sync interval changes or link break happens or there is a large adjustment in time this function is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure</td></tr>
  </table>
  </dd>
</dl>
<dl class="retval"><dt>Return values</dt><dd>
  <table class="retval">
    <tr><td class="paramname">None</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ade3b4bd7a3621759478b6043c83fa4e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_resetIEP </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Resets CMP1 once first adjustment is done, else 1PPS signal doesn't trigger. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>None </dd></dl>

</div>
</div>
<a class="anchor" id="ab54c2639b47e079c1eb32fcf933e3bca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_rxPhyDelayCorrection </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs PHY delay correction on Rx timestamp Assumption : The function expects the timestamp in rxTimestamp_gPTP field on which it does correction. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
<a class="anchor" id="acc6d5a7aed0c6574d98c34e859817463"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void TimeSync_updateParentAddress </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_time_sync___params_handle__s.html">TimeSync_ParamsHandle_t</a>&#160;</td>
          <td class="paramname"><em>timeSyncHandle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>parentMac</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write the MAC ID of PTP master to Firmware. BMC Algorithm calls this API. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">timeSyncHandle</td><td>pointer to PTP Handle structure </td></tr>
    <tr><td class="paramname">parentMac</td><td>Pointer to MAC ID of master. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>none </dd></dl>

</div>
</div>
</div><!-- contents -->
<hr size="1"><small>
Copyright  2020, Texas Instruments Incorporated</small>
</body>
</html>
